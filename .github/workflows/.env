# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# GitHub Actions Secrets Configuration
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#
# ⚠️  This file documents required secrets - it does NOT contain actual values.
# Configure actual secrets at: Repository Settings → Secrets and variables → Actions
#

# ============================================================================
# Required Secrets
# ============================================================================

# TARGET_REPO_PAT
# ---------------
# Purpose: Authenticate and push to EdenCoNz/proform repository
# Used by: .github/workflows/sync-to-proform.yml
#
# How to create:
#   1. GitHub Settings → Developer settings → Personal access tokens → Fine-grained tokens
#   2. Generate new token with:
#      - Repository access: Only EdenCoNz/proform
#      - Permissions: Contents (Read and write)
#   3. Add to repository: Settings → Secrets and variables → Actions → New repository secret
#      - Name: TARGET_REPO_PAT
#      - Value: <paste token>
#
# Recommended: Set 90-day expiration and create calendar reminder to rotate

# ============================================================================
# Frontend CI/CD (frontend-ci.yml)
# ============================================================================

# GITHUB_TOKEN Permissions
# ------------------------
# The workflow uses the built-in GITHUB_TOKEN with the following permissions:
#
# - contents: read (checkout code, read repository)
# - pull-requests: write (post coverage reports to PRs)
# - checks: write (create check runs)
# - issues: write (auto-close issues on successful build via reusable workflow)
# - packages: write (publish container images to GitHub Container Registry)
#
# Auto-Close Issue Feature:
# Issues created by workflow failures are automatically closed by the
# detect-workflow-failures.yml workflow when the same workflow succeeds later.
# This is handled automatically - no reusable workflow call needed.
#
# Container Registry Publishing:
# The workflow publishes validated container images to GitHub Container Registry (GHCR)
# at ghcr.io/<owner>/<repo>/frontend. Images are only published after passing all
# validation gates (functional tests, security scan, size optimization). Pull requests
# from forks are blocked from publishing for security. Authentication uses GITHUB_TOKEN
# automatically - no additional secrets required.

# Current Status: No additional secrets required
#
# The frontend CI/CD workflow runs using GITHUB_TOKEN for:
# - ESLint linting checks
# - Prettier formatting checks
# - TypeScript type checking
# - Production builds
# - Build artifact generation and upload
# - Security audit (npm audit)

# - Auto-closing issues on successful workflow runs (main branch only, via reusable workflow)
#
# Future Secrets (when implementing deployment):
# - Cloud provider credentials (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, etc.)
# - Deployment API tokens (NETLIFY_AUTH_TOKEN, VERCEL_TOKEN, etc.)
# - Environment-specific configuration secrets

# ============================================================================
# Detect Workflow Failures (detect-workflow-failures.yml)
# ============================================================================

# GITHUB_TOKEN Permissions
# ------------------------
# This workflow monitors Frontend CI/CD and Backend CI/CD workflows and:
#
# - contents: read (access repository contents and workflow files)
# - actions: read (read workflow run information via API)
# - issues: write (create issues for failures, close them on success)
#
# Workflow Behavior:
# ------------------
# On workflow failure (main branch only):
#   - Creates a single aggregated GitHub issue with all job/step failures
#   - Includes job/step names, job URLs, and metadata (runURL, runID, branch, commit)
#   - Labels issue with "workflow-failure" for easy tracking
#   - Follows markdown structure defined in docs/templates/issue-log-template.md
#
# On workflow success (main branch only):
#   - Automatically searches for open issues with "workflow-failure" label
#   - Finds issues matching the workflow name (e.g., "Frontend CI/CD")
#   - Closes all matching issues with a comment linking to the successful run
#   - Provides comprehensive summary in GitHub Step Summary
#
# This workflow has two jobs:
# 1. detect-failures: Runs when workflow fails/cancels, creates detailed issue
# 2. auto-close-issues: Runs when workflow succeeds, closes related failure issues
#
# Triggered by:
# - workflow_run event for "Frontend CI/CD" and "Backend CI/CD" workflows
# - Only monitors workflows on the default branch (main)
#
# Notes:
# - PR branch failures are handled inline by Frontend/Backend CI/CD workflows
# - This workflow provides detailed analysis for main branch failures only
# - Auto-close feature eliminates need for manual issue cleanup

# ============================================================================
# Backend CI/CD (backend-ci.yml)
# ============================================================================

# GITHUB_TOKEN Permissions
# ------------------------
# The workflow uses the built-in GITHUB_TOKEN with the following permissions:
#
# - contents: read (checkout code, read repository)
# - pull-requests: write (post coverage reports to PRs, auto-close PRs)
# - checks: write (create check runs)
# - issues: write (auto-close issues from commit messages, always runs regardless of CI status)
# - security-events: write (upload security scan results)

# Current Status: No additional secrets required
#
# The backend CI/CD workflow runs using GITHUB_TOKEN for:
# - Black formatting checks
# - isort import sorting checks
# - Flake8 linting
# - mypy type checking
# - pytest tests with coverage (unit, integration, e2e)
# - pip safety security scanning
# - Bandit security linting
# - Django build verification (collectstatic, check --deploy, migrations)
# - Auto-closing issues from commit messages (runs ALWAYS, even if CI fails)
#
# Auto-Close Issue Feature (Commit Message Based):
# Issues referenced in commit messages using the pattern 'fix issue #<number>' are
# automatically closed by the auto-close-issue-from-commit job. This job runs with
# if: always() to ensure it executes regardless of whether the CI workflow succeeds
# or fails. The feature supports:
# - Case-insensitive pattern matching (fix/Fix/fixes/fixed)
# - Multiple issue references in a single commit message
# - Different close messages based on CI status (success vs failure)
# - Validation that issues exist and are open before closing
# - Comprehensive GitHub Step Summary with closure status
#
# Pattern Examples:
# - "fix issue #123" → closes issue #123
# - "Fix issue #456" → closes issue #456
# - "fixes issue #789" → closes issue #789
# - "fixed issue #999 and fix issue #111" → closes both #999 and #111
#
# Services Used:
# - PostgreSQL 16 (service container for tests)
# - Redis 7 (service container for tests, cache/sessions)
#
# Environment Variables Required for CI/CD Jobs:
# ------------------------------------------------
# These environment variables are configured directly in the workflow file
# (backend-ci.yml) and do not require repository secrets.
#
# Type Checking (typecheck job):
# - SECRET_KEY: typecheck-secret-key-for-ci-validation-only
#   Purpose: Allow Django configuration validation during type checking
#   Note: This is a non-production value safe for CI/CD use only
# - DB_NAME: sqlite (dummy value for validation)
# - DEBUG: False (production-like type checking)
#
# Tests (test job):
# - DB_NAME: test_backend_db (provided by workflow)
# - DB_USER: test_user (provided by workflow)
# - DB_PASSWORD: test_password (provided by workflow)
# - DB_HOST: localhost (provided by workflow)
# - DB_PORT: 5432 (provided by workflow)
# - REDIS_URL: redis://localhost:6379/1 (provided by workflow)
# - SECRET_KEY: test-secret-key-for-ci-testing-only (provided by workflow)
# - DEBUG: False (provided by workflow)
#
# Build Verification (build job):
# - SECRET_KEY: build-verification-secret-key
# - DB_NAME: sqlite (dummy value for validation)
# - DEBUG: False (production-like checks)
#
# Container Functional Testing:
# - Uses service containers (PostgreSQL 16, Redis 7) for testing production container
# - Verifies container starts with database connectivity
# - Tests API endpoints accessibility and functionality
# - Validates health checks pass correctly
# - Runs in test-backend-prod-container job
# - No additional secrets required - uses test credentials only
#
# Future Secrets (when implementing deployment):
# - Cloud provider credentials (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, etc.)
# - Deployment API tokens (HEROKU_API_KEY, RAILWAY_TOKEN, etc.)
# - Production database credentials (if deploying migrations)
# - Environment-specific configuration secrets
# - SENTRY_DSN (for error tracking in production)
# - Email service credentials (SMTP settings)
